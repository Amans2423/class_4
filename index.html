<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Computer Adventure Game ‚Äì Fixed</title>
<style>
  :root{--accent:#0088dd;--good:#28a745;--bad:#dc3545}
  body{font-family:Inter, Poppins, system-ui, sans-serif;background:linear-gradient(180deg,#8ed6ff,#c9f1ff);padding:12px;margin:0}
  h1{text-align:center;color:#003f66;margin:6px 0 12px}
  .screen{max-width:920px;margin:0 auto;background:rgba(255,255,255,0.95);padding:18px;border-radius:12px;box-shadow:0 8px 30px rgba(0,0,0,0.12)}
  .topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
  .player{font-weight:600}
  .score{font-weight:700;background:#fff;border-radius:8px;padding:6px 10px;border:2px solid #eee}
  .level-title{text-align:center;font-size:20px;margin:8px 0;color:#004d73;font-weight:700}
  .progress-bar{height:14px;background:#eee;border-radius:10px;overflow:hidden;margin:8px 0}
  .progress-inner{height:100%;width:0;background:linear-gradient(90deg,#6bd26b,#00a86b);transition:width .35s}
  .question-box{background:#eaf6ff;padding:16px;border-radius:10px;font-size:18px;margin-bottom:12px}
  .options label{display:block;padding:10px 12px;background:#fff;margin:8px 0;border-radius:10px;cursor:pointer;border:2px solid #e6f4ff;font-size:16px}
  .options label:hover{background:#f6fbff}
  .correct{background:var(--good)!important;border-color:green!important}
  .wrong{background:var(--bad)!important;border-color:darkred!important}
  .explain{padding:12px;background:#fff3c4;border-radius:8px;margin-top:10px;font-size:15px}
  .controls{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-top:10px}
  .pbtn{background:#ffb300;border:none;padding:8px 12px;border-radius:8px;cursor:pointer}
  .pbtn[disabled]{opacity:.5;cursor:default}
  .name-input{padding:10px;border-radius:8px;border:2px solid #cfe;min-width:180px}
  .chars{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin:8px 0}
  .char{background:#fff;padding:8px 12px;border-radius:8px;border:2px solid #e3eefc;cursor:pointer}
  .char.selected{border-color:var(--accent);background:#eaf6ff}
  .world-map{display:flex;gap:12px;justify-content:center;font-size:28px;margin:10px 0}
  .hidden{display:none}
  .report{margin-top:12px}
  .report table{width:100%;border-collapse:collapse}
  .report th,.report td{padding:8px;border:1px solid #eee;text-align:left}

  @media (max-width:600px){
    .screen{padding:12px}
    .question-box{font-size:16px}
    .options label{font-size:15px;padding:10px}
    .name-input{width:100%}
    .chars{gap:6px}
  }
</style>
</head>
<body>
  <h1>Computer Adventure Game</h1>
  <div class="screen" id="game"></div>

  <!-- Sounds -->
  <audio id="bgMusic" src="https://files.catbox.moe/8p9l0n.mp3" loop preload="auto"></audio>
  <audio id="tick" src="https://assets.mixkit.co/sfx/preview/mixkit-big-bell-1.mp3" preload="auto"></audio>
  <audio id="correctSound" src="https://assets.mixkit.co/sfx/preview/mixkit-video-game-win-2016.mp3" preload="auto"></audio>
  <audio id="wrongSound" src="https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-voice-buzzer-948.mp3" preload="auto"></audio>

<script>
// ---------- DATA ----------
const levels = [
  {
    name:'Level 1 - Tux Paint Basics', icon:'üé®', questions:[
      {q:'Tux Paint is mainly used for ______.', opts:['Drawing','Music','Internet','Games'], ans:'drawing', exp:'Tux Paint is a drawing software for kids.'},
      {q:'Which tool adds ready-made stickers in Tux Paint?', opts:['Lines','Stamp','Text','Undo'], ans:'stamp', exp:'Stamp tool adds stickers and shapes.'},
      {q:'Magic Tool is used for ______ effects.', opts:['Sound','Painting','Special','Typing'], ans:'special', exp:'Magic tool adds special painting effects.'},
      {q:'Eraser tool helps to ______.', opts:['Draw','Erase','Color','Type'], ans:'erase', exp:'Eraser removes parts of a drawing.'},
      {q:'The Save button stores your ______.', opts:['Music','Drawing','Game','Video'], ans:'drawing', exp:'Save stores your artwork.'}
    ]
  },
  {
    name:'Level 2 - Keyboard Skills', icon:'‚å®Ô∏è', questions:[
      {q:'Spacebar key adds a ______.', opts:['Letter','Line','Space','Number'], ans:'space', exp:'Spacebar inserts a space between words.'},
      {q:'Shift key is used to type ______ letters.', opts:['Small','Capital','Blue','Hidden'], ans:'capital', exp:'Shift + letter makes capital letters.'},
      {q:'Enter key moves the cursor to new ______.', opts:['Page','Line','File','Tab'], ans:'line', exp:'Enter jumps to a new line.'},
      {q:'Number keys type ______.', opts:['Colors','Digits','Folders','Pictures'], ans:'digits', exp:'Number keys are for digits.'},
      {q:'Arrow keys help in ______.', opts:['Navigation','Painting','Sleeping','Printing'], ans:'navigation', exp:'Arrow keys move the cursor in directions.'}
    ]
  },
  {
    name:'Level 3 - Logo Turtle Commands', icon:'üê¢', questions:[
      {q:'FD 50 makes the turtle move ______.', opts:['Backward','Forward 50 steps','Right','Left'], ans:'forward 50 steps', exp:'FD means forward movement.'},
      {q:'RT 90 will turn turtle ______.', opts:['Left 90¬∞','Right 90¬∞','Up','Down'], ans:'right 90¬∞', exp:'RT means turn right.'},
      {q:'BK 40 moves turtle ______.', opts:['Forward','Backward','Side','Up'], ans:'backward', exp:'BK means backward movement.'},
      {q:'LT command turns the turtle ______.', opts:['Right','Left','Back','Round'], ans:'left', exp:'LT means turn left.'},
      {q:'REPEAT 4 [FD 50 RT 90] draws a ______.', opts:['Circle','Square','Triangle','Line'], ans:'square', exp:'This repeats 4 sides turning 90¬∞ to make a square.'}
    ]
  },
  {
    name:'Level 4 - Internet Basics', icon:'üåê', questions:[
      {q:'Internet connects many ______.', opts:['Computers','Animals','Cars','Houses'], ans:'computers', exp:'Internet is a network of computers.'},
      {q:'A web browser helps you ______ the web.', opts:['Eat','Browse','Sleep','Drive'], ans:'browse', exp:'Browsers allow you to surf the internet.'},
      {q:'Google is a ______.', opts:['Search engine','Game','Keyboard','Virus'], ans:'search engine', exp:'Google helps search information.'},
      {q:'Email is used to send ______.', opts:['Food','Messages','Water','Movies'], ans:'messages', exp:'Email is for sending messages online.'},
      {q:'Wi-Fi helps connect to ______.', opts:['Books','Internet','Trees','Games'], ans:'internet', exp:'Wi-Fi provides wireless internet access.'}
    ]
  },
  {
    name:'Level 5 - Final Mixed Test', icon:'üèÅ', questions:[
      {q:'Stamp tool is found in ______.', opts:['Logo','Tux Paint','Notepad','Calculator'], ans:'tux paint', exp:'Stamp tool belongs to Tux Paint.'},
      {q:'FD means ______ in Logo.', opts:['Forward','Fast Down','File Download','Far Distance'], ans:'forward', exp:'FD means Forward.'},
      {q:'Shift key helps in typing ______ letters.', opts:['Capital','Small','Random','Green'], ans:'capital', exp:'Shift creates capital letters.'},
      {q:'Internet lets you ______ online.', opts:['Draw','Browse information','Drive','Cook'], ans:'browse information', exp:'Internet helps find information.'},
      {q:'RT makes the turtle turn ______.', opts:['Right','Left','Up','In'], ans:'right', exp:'RT stands for Right Turn.'}
    ]
  }
];

// ---------- STATE ----------
let playerName = '';
let character = '';
let levelIndex = 0;
let qIndex = 0;
let score = 0;
let report = []; // store each Q result

const game = document.getElementById('game');
const bgMusic = document.getElementById('bgMusic');

// ---------- HELPERS ----------
function normalize(s){ return String(s||'').trim().toLowerCase().replace(/[^a-z0-9]/g,''); }
function play(id){ try{ document.getElementById(id).currentTime=0; document.getElementById(id).play(); }catch(e){}
}

// ---------- UI SCREENS ----------
function loadStart(){
  levelIndex = 0; qIndex = 0; score = 0; report = [];
  game.innerHTML = `
    <div class='topbar'><div class='player'>Enter name and choose character</div><div class='score'>Score: <b>0</b></div></div>

    <div style='text-align:center;margin:8px 0'>
      <input id='pname' class='name-input' placeholder='Your name'>
    </div>

    <div class='chars'>${['üßí Boy','üëß Girl','ü§ñ Robot','üê± Cat'].map(c=>`<div class='char' onclick="chooseChar(this)">${c}</div>`).join('')}</div>

    <div style='text-align:center;margin-top:12px'>
      <button class='btn' onclick='startGame()'>Start Adventure</button>
    </div>
  `;
}

function chooseChar(el){
  document.querySelectorAll('.char').forEach(x=>x.classList.remove('selected'));
  el.classList.add('selected');
  character = el.innerText;
}

function startGame(){
  const name = document.getElementById('pname').value.trim();
  if(!name){ alert('Please enter your name'); return; }
  if(!character){ alert('Please choose a character'); return; }
  playerName = name;
  // start bg music (user action triggered)
  try{ bgMusic.volume = 0.25; bgMusic.play(); }catch(e){}
  levelIndex = 0; qIndex = 0; score = 0; report = [];
  renderQuestion();
}

// ---------- RENDER QUESTION ----------
function renderQuestion(){
  const level = levels[levelIndex];
  const q = level.questions[qIndex];

  // progress for this level
  const progress = Math.round((qIndex / level.questions.length) * 100);

  // build options
  const optionsHtml = q.opts.map(opt => `<label onclick='handleAnswer(this)'>${opt}</label>`).join('');

  game.innerHTML = `
    <div class='topbar'><div class='player'>Player: <b>${playerName}</b> ‚Äî ${character}</div>
    <div class='score'>Score: <b>${score}</b></div></div>

    <div class='level-title'>${level.icon} ${level.name}</div>
    <div class='progress-bar'><div class='progress-inner' style='width:${progress}%'></div></div>
    <div class='question-box'>${q.q}</div>
    <div class='options'>${optionsHtml}</div>

    <div class='controls'>
      <button class='pbtn' id='extraBtn' onclick='useExtra()'>‚è± Extra Time</button>
      <button class='pbtn' id='skipBtn' onclick='useSkip()'>‚è≠ Skip</button>
      <button class='pbtn' id='fiftyBtn' onclick='useFifty()'>5Ô∏è‚É£0Ô∏è‚É£-5Ô∏è‚É£0Ô∏è‚É£</button>
    </div>
  `;
}

// ---------- ANSWER HANDLING ----------
function handleAnswer(labelEl){
  // prevent double clicks
  if(labelEl.dataset.done) return;
  labelEl.dataset.done = '1';

  const level = levels[levelIndex];
  const q = level.questions[qIndex];
  const chosenRaw = labelEl.innerText.trim();
  const chosen = normalize(chosenRaw);
  const correct = normalize(q.ans);

  // mark options visually
  document.querySelectorAll('.options label').forEach(l=>{
    const n = normalize(l.innerText);
    if(n === correct) l.classList.add('correct');
    if(l === labelEl && n !== correct) l.classList.add('wrong');
    l.style.pointerEvents = 'none';
  });

  // scoring
  const wasCorrect = (chosen === correct);
  if(wasCorrect) { score += 1; play('correctSound'); }
  else { play('wrongSound'); }

  // record for report
  report.push({ level: level.name, question: q.q, selected: chosenRaw, correct: q.ans, correctFlag: wasCorrect });

  // explanation + TTS
  const explain = document.createElement('div');
  explain.className = 'explain';
  explain.innerHTML = `<b>Correct:</b> ${q.ans.toUpperCase()}<br>${q.exp}`;
  document.querySelector('.options').after(explain);
  speak(q.exp);

  // update score display instantly
  const scoreBox = document.querySelector('.score b'); if(scoreBox) scoreBox.innerText = score;

  // proceed to next question after short pause so student sees feedback
  setTimeout(() => nextQuestion(), 900);
}

// ---------- NEXT QUESTION & LEVEL FLOW ----------
function nextQuestion(){
  const level = levels[levelIndex];
  qIndex++;
  if(qIndex >= level.questions.length){
    // move to next level automatically
    levelIndex++;
    if(levelIndex >= levels.length){
      return finishGame();
    }
    qIndex = 0; // start next level first question
  }
  renderQuestion();
}

// ---------- POWER-UPS ----------
let usedExtra = false, usedSkip = false, usedFifty = false;
function useExtra(){ if(usedExtra) return alert('Extra Time already used for this level'); usedExtra = true; document.getElementById('extraBtn').disabled = true; alert('Extra time granted (no timer in this mode).'); }
function useSkip(){ if(usedSkip) return alert('Skip already used for this level'); usedSkip = true; document.getElementById('skipBtn').disabled = true; // record as skipped
  report.push({ level: levels[levelIndex].name, question: levels[levelIndex].questions[qIndex].q, selected: 'SKIPPED', correct: levels[levelIndex].questions[qIndex].ans, correctFlag: false });
  // immediate next
  nextQuestion(); }
function useFifty(){ if(usedFifty) return alert('50-50 already used for this level'); usedFifty = true; document.getElementById('fiftyBtn').disabled = true;
  const q = levels[levelIndex].questions[qIndex];
  const correct = normalize(q.ans);
  const labels = Array.from(document.querySelectorAll('.options label'));
  // hide up to half wrong options
  let wrongs = labels.filter(l=>normalize(l.innerText) !== correct);
  // remove randomly until ~half remain
  const toHide = Math.ceil(wrongs.length/2);
  for(let i=0;i<toHide;i++){ const idx = Math.floor(Math.random()*wrongs.length); wrongs[idx].style.display='none'; wrongs.splice(idx,1); }
}

// ---------- TTS ----------
function speak(text){ try{ const msg = new SpeechSynthesisUtterance(text); msg.rate=0.95; speechSynthesis.cancel(); speechSynthesis.speak(msg); }catch(e){} }

// ---------- FINISH & REPORT ----------
function finishGame(){
  // compute medal
  let medal='ü•â Bronze';
  if(score >= 23) medal='ü•á Gold'; else if(score >= 18) medal='ü•à Silver';

  // build report table
  let rows = report.map(r => `<tr><td>${r.level}</td><td>${r.question}</td><td>${r.selected}</td><td>${r.correct}</td><td>${r.correctFlag? '‚úî':'‚úñ'}</td></tr>`).join('');

  game.innerHTML = `
    <div class='topbar'><div class='player'>Player: <b>${playerName}</b> ‚Äî ${character}</div>
    <div class='score'>Final Score: <b>${score}</b></div></div>
    <div style='text-align:center;margin:8px 0'><h2>üéâ Adventure Complete!</h2><div style='font-size:18px;margin:6px'>Medal: <b>${medal}</b></div></div>
    <div class='report'><h3>Report card</h3>
      <table><thead><tr><th>Level</th><th>Question</th><th>Your Answer</th><th>Correct</th><th>OK</th></tr></thead><tbody>${rows}</tbody></table>
    </div>
    <div style='text-align:center;margin-top:12px'><button class='btn' onclick='location.reload()'>Play Again</button></div>
  `;
}

// ---------- INIT ----------
loadStart();
</script>
</body>
</html>
